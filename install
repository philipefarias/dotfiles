#!/usr/bin/env bash
set -e

here="$(cd "${0%/*}"; pwd)"

echo "===> Linking dotfiles:"
for file in bash_profile bashrc gitconfig gitignore_global gitmessage vimrc nvimrc tmux.conf agignore; do
  ln -sfhv "$here/$file" "${HOME}/.$file"
done

echo

echo "===> Linking binaries:"
if [ ! -d "${HOME}/.bin" ]; then
  mkdir "${HOME}/.bin"
fi

for file in `ls "$here/bin"`; do
  ln -sfhv "$here/bin/$file" "${HOME}/.bin/$file"
done

echo

echo
echo "===> Setting up Vim:"
mkdir -p "${HOME}/.vim/.backup" && echo "Vim backup directory created"
mkdir -p "${HOME}/.vim/.tmp" && echo "Vim tmp directory created"

if git --version &>/dev/null; then
  vundle_dir="${HOME}/.vim/bundle/Vundle.vim"

  if [ ! -d "$vundle_dir" ]; then
    echo "Getting Vundle"
    git clone "https://github.com/gmarik/Vundle.vim.git" "$vundle_dir"
  else
    echo "Vundle detected, just installing plugins..."
  fi

  vim +PluginInstall +qall && echo "Vim plugins installed"
  echo
fi
